<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - CodeMaster Academy</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/payment-modal.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-code"></i>
                <span>CodeMaster Academy</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#courses">Courses</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a href="#" class="btn-login">Login</a></li>
                <li><a href="#" class="btn-signup">Sign Up</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Settings Page Content -->
    <main class="settings-page">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="breadcrumb">
                    <a href="index.html">Home</a> > <span>Settings</span>
                </div>
                <h1><i class="fas fa-cog"></i> Settings</h1>
                <p>Customize your learning experience and account preferences</p>
            </div>

            <!-- Settings Content -->
            <div class="settings-content">
                <!-- Settings Sidebar -->
                <div class="settings-sidebar">
                    <div class="settings-nav">
                        <a href="#" class="nav-item active" data-tab="general-settings">
                            <i class="fas fa-sliders-h"></i> General
                        </a>
                        <a href="#" class="nav-item" data-tab="appearance-settings">
                            <i class="fas fa-palette"></i> Appearance
                        </a>
                        <a href="#" class="nav-item" data-tab="learning-settings">
                            <i class="fas fa-graduation-cap"></i> Learning
                        </a>
                        <a href="#" class="nav-item" data-tab="notification-settings">
                            <i class="fas fa-bell"></i> Notifications
                        </a>
                        <a href="#" class="nav-item" data-tab="privacy-settings">
                            <i class="fas fa-shield-alt"></i> Privacy
                        </a>
                        <a href="profile.html" class="nav-item">
                            <i class="fas fa-user"></i> Back to Profile
                        </a>
                    </div>
                </div>

                <!-- Settings Main Content -->
                <div class="settings-main">
                    <!-- General Settings Tab -->
                    <div class="tab-content active" id="general-settings">
                        <div class="content-header">
                            <h2>General Settings</h2>
                            <p>Basic account and application preferences</p>
                        </div>

                        <div class="settings-section">
                            <h3>Language & Region</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Language</h4>
                                    <p>Select your preferred language</p>
                                </div>
                                <select id="languageSelect" class="setting-select">
                                    <option value="en">English</option>
                                    <option value="es">Español</option>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                    <option value="pt">Português</option>
                                </select>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Time Zone</h4>
                                    <p>Set your local time zone for scheduling</p>
                                </div>
                                <select id="timezoneSelect" class="setting-select">
                                    <option value="UTC">UTC (Coordinated Universal Time)</option>
                                    <option value="EST">EST (Eastern Standard Time)</option>
                                    <option value="PST">PST (Pacific Standard Time)</option>
                                    <option value="GMT">GMT (Greenwich Mean Time)</option>
                                    <option value="CET">CET (Central European Time)</option>
                                </select>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Accessibility</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>High Contrast Mode</h4>
                                    <p>Increase contrast for better visibility</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="highContrast">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Reduce Motion</h4>
                                    <p>Minimize animations and transitions</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="reduceMotion">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Appearance Settings Tab -->
                    <div class="tab-content" id="appearance-settings">
                        <div class="content-header">
                            <h2>Appearance</h2>
                            <p>Customize the look and feel of your learning environment</p>
                        </div>

                        <div class="settings-section">
                            <h3>Theme</h3>
                            <div class="theme-options">
                                <div class="theme-option" data-theme="light">
                                    <div class="theme-preview light">
                                        <div class="preview-header"></div>
                                        <div class="preview-content">
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-main"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <h4>Light</h4>
                                        <p>Clean and bright interface</p>
                                    </div>
                                    <input type="radio" name="theme" value="light" checked>
                                </div>

                                <div class="theme-option" data-theme="dark">
                                    <div class="theme-preview dark">
                                        <div class="preview-header"></div>
                                        <div class="preview-content">
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-main"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <h4>Dark</h4>
                                        <p>Easy on the eyes for long sessions</p>
                                    </div>
                                    <input type="radio" name="theme" value="dark">
                                </div>

                                <div class="theme-option" data-theme="auto">
                                    <div class="theme-preview auto">
                                        <div class="preview-header"></div>
                                        <div class="preview-content">
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-main"></div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <h4>Auto</h4>
                                        <p>Matches your system preference</p>
                                    </div>
                                    <input type="radio" name="theme" value="auto">
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Display</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Font Size</h4>
                                    <p>Adjust text size for better readability</p>
                                </div>
                                <select id="fontSizeSelect" class="setting-select">
                                    <option value="small">Small</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="large">Large</option>
                                    <option value="extra-large">Extra Large</option>
                                </select>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Compact Mode</h4>
                                    <p>Use more compact spacing to fit more content</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="compactMode">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Learning Settings Tab -->
                    <div class="tab-content" id="learning-settings">
                        <div class="content-header">
                            <h2>Learning Preferences</h2>
                            <p>Customize your learning experience and video playback</p>
                        </div>

                        <div class="settings-section">
                            <h3>Video Playback</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Default Playback Speed</h4>
                                    <p>Set your preferred video playback speed</p>
                                </div>
                                <select id="playbackSpeedSelect" class="setting-select">
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1.0" selected>1.0x (Normal)</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2.0">2.0x</option>
                                </select>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Autoplay Next Video</h4>
                                    <p>Automatically play the next lesson when current one ends</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoplayNext" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Show Subtitles</h4>
                                    <p>Display subtitles by default when available</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showSubtitles">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Learning Experience</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Sound Effects</h4>
                                    <p>Play sounds for achievements and interactions</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="soundEffects" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Progress Reminders</h4>
                                    <p>Get gentle reminders to continue your learning</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="progressReminders" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Skip Intro Videos</h4>
                                    <p>Automatically skip course introduction videos</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="skipIntros">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Notification Settings Tab -->
                    <div class="tab-content" id="notification-settings">
                        <div class="content-header">
                            <h2>Notifications</h2>
                            <p>Control how and when you receive notifications</p>
                        </div>

                        <div class="settings-section">
                            <h3>Email Notifications</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Course Updates</h4>
                                    <p>Receive notifications about course progress and new content</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="courseUpdates" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Marketing Emails</h4>
                                    <p>Receive information about new courses and special offers</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="marketingEmails">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Achievement Notifications</h4>
                                    <p>Get notified when you earn badges and complete milestones</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="achievementNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Push Notifications</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Browser Notifications</h4>
                                    <p>Allow browser notifications for important updates</p>
                                </div>
                                <button class="btn btn-secondary" onclick="requestNotificationPermission()">
                                    <i class="fas fa-bell"></i> Enable Notifications
                                </button>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Study Reminders</h4>
                                    <p>Get reminded to continue your learning journey</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="studyReminders" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Settings Tab -->
                    <div class="tab-content" id="privacy-settings">
                        <div class="content-header">
                            <h2>Privacy & Data</h2>
                            <p>Control your privacy settings and data usage</p>
                        </div>

                        <div class="settings-section">
                            <h3>Profile Visibility</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Public Profile</h4>
                                    <p>Allow others to view your profile information</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="publicProfile" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Show Learning Progress</h4>
                                    <p>Display your course progress on your public profile</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showProgress" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Show Achievements</h4>
                                    <p>Display your badges and achievements publicly</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showAchievements" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>Data & Analytics</h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Usage Analytics</h4>
                                    <p>Help us improve by sharing anonymous usage data</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="analytics" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Personalized Recommendations</h4>
                                    <p>Use your learning data to suggest relevant courses</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="recommendations" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4>Download My Data</h4>
                                    <p>Get a copy of all your data stored with us</p>
                                </div>
                                <button class="btn btn-secondary" onclick="downloadUserData()">
                                    <i class="fas fa-download"></i> Download Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Footer -->
            <div class="settings-footer">
                <button class="btn btn-secondary" onclick="resetToDefaults()">
                    <i class="fas fa-undo"></i> Reset to Defaults
                </button>
                <button class="btn btn-primary" onclick="saveAllSettings()">
                    <i class="fas fa-save"></i> Save All Settings
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-code"></i>
                        <span>CodeMaster Academy</span>
                    </div>
                    <p>Empowering the next generation of programmers with world-class education and practical skills.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#courses">Courses</a></li>
                        <li><a href="profile.html">Profile</a></li>
                        <li><a href="settings.html">Settings</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 CodeMaster Academy. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Application Scripts -->
    <script src="assets/js/supabase-config.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/profile-manager.js"></script>
    <script src="assets/js/settings-manager.js"></script>
    <script src="assets/js/courses-data.js"></script>
    <script src="assets/js/script.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        // Settings page specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeSettingsPage();
        });

        function initializeSettingsPage() {
            // Check if user is authenticated
            if (!window.supabaseAuth || !window.supabaseAuth.isAuthenticated()) {
                // Redirect to home page if not logged in
                window.location.href = 'index.html';
                return;
            }

            // Initialize tab navigation
            initializeTabNavigation();
            
            // Initialize theme selection
            initializeThemeSelection();
            
            // Load saved settings
            loadSavedSettings();
        }

        function initializeTabNavigation() {
            const navItems = document.querySelectorAll('.settings-nav .nav-item');
            const tabContents = document.querySelectorAll('.tab-content');

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    const tabId = item.getAttribute('data-tab');
                    if (!tabId) return;

                    // Remove active class from all nav items and tabs
                    navItems.forEach(nav => nav.classList.remove('active'));
                    tabContents.forEach(tab => tab.classList.remove('active'));

                    // Add active class to clicked nav item and corresponding tab
                    item.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        function initializeThemeSelection() {
            const themeOptions = document.querySelectorAll('.theme-option');
            
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.getAttribute('data-theme');
                    const radio = option.querySelector('input[type="radio"]');
                    
                    // Update radio selection
                    document.querySelectorAll('input[name="theme"]').forEach(r => r.checked = false);
                    radio.checked = true;
                    
                    // Apply theme immediately
                    applyTheme(theme);
                });
            });
        }

        function applyTheme(theme) {
            const body = document.body;
            
            // Remove existing theme classes
            body.classList.remove('theme-light', 'theme-dark');
            
            if (theme === 'dark') {
                body.classList.add('theme-dark');
            } else if (theme === 'light') {
                body.classList.add('theme-light');
            } else if (theme === 'auto') {
                // Use system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                body.classList.add(prefersDark ? 'theme-dark' : 'theme-light');
            }
        }

        function loadSavedSettings() {
            // Load settings from localStorage or default values
            const currentUser = window.supabaseAuth.getCurrentUser();
            if (!currentUser) return;

            const savedSettings = localStorage.getItem(`user_settings_${currentUser.id}`);
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // Apply saved settings to form elements
                Object.keys(settings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = settings[key];
                        } else {
                            element.value = settings[key];
                        }
                    }
                });
                
                // Apply theme
                if (settings.theme) {
                    applyTheme(settings.theme);
                }
            }
        }

        async function saveAllSettings() {
            try {
                const currentUser = window.supabaseAuth.getCurrentUser();
                if (!currentUser) return;

                // Collect all settings
                const settings = {
                    language: document.getElementById('languageSelect').value,
                    timezone: document.getElementById('timezoneSelect').value,
                    theme: document.querySelector('input[name="theme"]:checked').value,
                    fontSize: document.getElementById('fontSizeSelect').value,
                    playbackSpeed: parseFloat(document.getElementById('playbackSpeedSelect').value),
                    autoplayNext: document.getElementById('autoplayNext').checked,
                    showSubtitles: document.getElementById('showSubtitles').checked,
                    soundEffects: document.getElementById('soundEffects').checked,
                    courseUpdates: document.getElementById('courseUpdates').checked,
                    marketingEmails: document.getElementById('marketingEmails').checked,
                    publicProfile: document.getElementById('publicProfile').checked,
                    analytics: document.getElementById('analytics').checked
                };

                // Save to localStorage
                localStorage.setItem(`user_settings_${currentUser.id}`, JSON.stringify(settings));

                // Apply theme
                applyTheme(settings.theme);

                showNotification('Settings saved successfully!', 'success');

            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Failed to save settings. Please try again.', 'error');
            }
        }

        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to their default values?')) {
                const currentUser = window.supabaseAuth.getCurrentUser();
                if (currentUser) {
                    localStorage.removeItem(`user_settings_${currentUser.id}`);
                }
                
                // Reset form to defaults
                document.getElementById('languageSelect').value = 'en';
                document.getElementById('timezoneSelect').value = 'UTC';
                document.querySelector('input[value="light"]').checked = true;
                document.getElementById('fontSizeSelect').value = 'medium';
                document.getElementById('playbackSpeedSelect').value = '1.0';
                
                // Reset checkboxes to defaults
                document.getElementById('autoplayNext').checked = true;
                document.getElementById('soundEffects').checked = true;
                document.getElementById('courseUpdates').checked = true;
                document.getElementById('publicProfile').checked = true;
                document.getElementById('analytics').checked = true;
                
                applyTheme('light');
                
                showNotification('Settings reset to defaults', 'info');
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showNotification('Browser notifications enabled!', 'success');
                    } else {
                        showNotification('Notification permission denied', 'warning');
                    }
                });
            } else {
                showNotification('Browser notifications not supported', 'warning');
            }
        }

        function downloadUserData() {
            showNotification('Data download feature will be available soon!', 'info');
        }

        function showNotification(message, type = 'info') {
            // Use the global notification system if available
            if (window.showNotification) {
                window.showNotification(message, type);
            } else {
                alert(message);
            }
        }
    </script>
</body>
</html>